TAILSCALE_KEY = "tskey-auth-knSMgtYmY711CNTRL-JZAhJYGydpT86fhYYSiapTab5hNqMXA2"
Vagrant.configure("2") do |config|
  
  # OS configuration
  config.vm.box = "generic/ubuntu2204"
  config.vm.box_version = "4.3.12"
  
  config.vm.provider :libvirt do |libvirt|
    libvirt.memory = 1024
    libvirt.cpus = 1
  end

  config.vm.provision "shell", inline: <<-SHELL
    apt-get update
    apt-get install -y git
    cd /home/vagrant
    git clone https://github.com/RafaMazoliniF/Plantractor.git
    cd Plantractor
    git switch -c development
    git pull origin development
  SHELL

  config.vm.define "VM1" do |vm1|
    vm1.vm.network :public_network, :dev => "br0"
    vm1.vm.network :private_network, ip: "10.0.1.10"
    vm1.vm.provision "shell", path: "config-tailscale.sh", args: [TAILSCALE_KEY, "VM1"]
    vm1.vm.provision "shell", path: "config-webserver.sh"
  end

  config.vm.define "VM2" do |vm2|
    vm2.vm.provider :libvirt do |lv|
        lv.management_network_name = "isolated_net"
        lv.management_network_address = "10.0.1.0/24"
        lv.management_network_mode = "none"
    end
    vm2.vm.network :private_network, ip: "10.0.1.20"
    vm1.vm.provision "shell", path: "config-webserver.sh"
  end

  config.vm.define "VM3" do |vm3|
    vm3.vm.provider :libvirt do |lv|
        lv.management_network_name = "isolated_net"
        lv.management_network_address = "10.0.1.0/24"
        lv.management_network_mode = "none"
    end
    vm3.vm.network :private_network, ip: "10.0.1.30"
    vm1.vm.provision "shell", path: "config-database.sh"
  end
end